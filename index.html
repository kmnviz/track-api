<!doctype html>
<html>
<head>
    <title>This is the title of the webpage!</title>
    <audio controls id="audio"></audio>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>
<body>
    <p>This is an example paragraph. Anything in the <strong>body</strong> tag will appear on the page, just like this <strong>p</strong> tag and its contents.</p>
    <button onclick="fetchNext(0)">fetch</button>
    <button onclick="audio.play()">play</button>
</body>
<script>
// chunks
const chunkCounts = 6;

// media source
const mimeCodec = 'audio/mpeg';
const mediaSource = new MediaSource;

// audio
const audio = document.getElementById('audio');
audio.src = URL.createObjectURL(mediaSource);

// on media source open
let sourceBuffer;
mediaSource.onsourceopen = () => {
    mediaSource.duration = 59;
    sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);
};

// fetch
const url = 'http://localhost:3030/chunk/1/t-e0346c18c2632d27';
const fetch = (number) => {
    console.log(number);
    return new Promise((resolve) => {
        axios.get(`${url}/${number * 10}`, { responseType: 'arraybuffer' })
            .then((res) => {
                sourceBuffer.appendBuffer(res['data']);
                resolve(number);
            });
    });
};
const fetchNext = (number) => {
    fetch(number).then(() => {
        number++;
        if (number < chunkCounts) {
            fetchNext(number);
        }
    });
};
</script>
</html>