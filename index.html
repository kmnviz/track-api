<!doctype html>
<html>
<head>
    <title>This is the title of the webpage!</title>
    <audio controls id="audio"></audio>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/axios/0.21.1/axios.min.js"></script>
</head>
<body>
    <p>This is an example paragraph. Anything in the <strong>body</strong> tag will appear on the page, just like this <strong>p</strong> tag and its contents.</p>
    <button onclick="fetchContent()">fetch</button>
    <button onclick="play()">play</button>
</body>
<script>
const chunks = [];
const audio = document.getElementById('audio');
const mimeCodec = 'audio/mpeg';
const mediaSource = new MediaSource;

let sourceBuffer;
mediaSource.onsourceopen = () => {
    mediaSource.duration = 59;
    sourceBuffer = mediaSource.addSourceBuffer(mimeCodec);
    sourceBuffer.onupdateend = () => {};
    sourceBuffer.appendBuffer(chunks[0]);
    audio.play();
};

const fetchContent = () => {
    const url = 'http://localhost:3030/chunk/1/t-e0346c18c2632d27';
    // const url = 'http://localhost:3030/content/1/t-e9f2dba2f5e709dc';

    axios.get(`${url}/1`, { responseType: 'arraybuffer' })
        .then((res) => {
            chunks.push(res['data']);
            audio.src = URL.createObjectURL(mediaSource);
        });

    setTimeout(() => {
        axios.get(`${url}/11`, { responseType: 'arraybuffer' })
            .then((res) => {
                chunks.push(res['data']);
                sourceBuffer.appendBuffer(chunks[1]);
            });
    }, 2000);

    setTimeout(() => {
        axios.get(`${url}/21`, { responseType: 'arraybuffer' })
            .then((res) => {
                chunks.push(res['data']);
                sourceBuffer.appendBuffer(chunks[2]);
            });
    }, 4000);

    setTimeout(() => {
        axios.get(`${url}/31`, { responseType: 'arraybuffer' })
            .then((res) => {
                chunks.push(res['data']);
                sourceBuffer.appendBuffer(chunks[3]);
            });
    }, 6000);

    setTimeout(() => {
        axios.get(`${url}/41`, { responseType: 'arraybuffer' })
            .then((res) => {
                chunks.push(res['data']);
                sourceBuffer.appendBuffer(chunks[4]);
            });
    }, 8000);

    setTimeout(() => {
        axios.get(`${url}/51`, { responseType: 'arraybuffer' })
            .then((res) => {
                chunks.push(res['data']);
                sourceBuffer.appendBuffer(chunks[5]);
            });
    }, 10000);
};

const play = () => {
    audio.play();
};
</script>
</html>